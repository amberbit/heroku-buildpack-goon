#!/usr/bin/env bash

set -e

BIN_PATH="$1/.goon"
TMP_PATH="$1/tmp"
mkdir -p $BIN_PATH $TMP_PATH

GOON_URL="https://github.com/alco/goon/releases/download/v1.1.1/goon_linux_amd64.tar.gz"

echo "-----> Downloading goon package"
curl -L $GOON_URL -o /tmp/goon.tar.gz

echo "-----> Unpacking goon package"
tar -xzf goon.tar.gz -C /tmp

echo "-----> Setting permissions"
chmod +x /tmp/goon

echo "-----> Moving binaries to the right place"
mv /tmp/goon $BIN_PATH/

echo "-----> Cleaning up"
rm -rf goon.tar.gz /tmp/goon /tmp/goon_linux_amd64_fixed.zip

echo "-----> Adjusting environment variables"
mkdir $1/.profile.d
echo "export PATH=\$PATH:/app/.goon" > $1/.profile.d/goon.sh
chmod +x $1/.profile.d/goon.sh

exit 0
